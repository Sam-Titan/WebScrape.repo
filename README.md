New changes with function and error handling
